#! /usr/bin/env bash

# check that DOTFILES variable is defined
# shellcheck disable=SC1090
source "${BASH_SOURCE%/*}/../check_dotfiles_variable.sh"

source "$DOTFILES/infra/scripts/prompts.sh"

main() {
  "$DOTFILES/infra/scripts/is_macos.sh" && {
    setup_tmux_terminfo
  }
}

# set up `tmux-256color` `terminfo` entry from modern `ncurses`
# ref - https://gist.github.com/bbqtd/a4ac060d6f6b9ea6fe3aabe735aa9d95
setup_tmux_terminfo() {
  toe | grep -q "tmux-256color" && {
    info 'skipping terminfo setup: already installed'
    return 0
  }

  # compile `tmux-256color.info` using modern `ncurses`
  "infocmp" "tmux-256color" > "${TMPDIR}tmux-256color.info"
  # then install the compiled entry to the system `terminfo` database
  # shellcheck disable=SC2016
  info 'Using `sudo` to install `tmux-256color` `terminfo` entry'
  # install to system database
  /usr/bin/tic -xe "tmux-256color" "${TMPDIR}tmux-256color.info"
}

main "$@"
