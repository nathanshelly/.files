#! /usr/bin/env zsh

# check that DOTFILES variable is defined
check_dotfiles_path="${0:A:h}/../../infra/setup/check_dotfiles_variable.sh"
source "$check_dotfiles_path:a" # resolve `../..` to valid path

source "$DOTFILES/infra/scripts/prompts.sh"

"$DOTFILES/infra/scripts/is_macos.sh" || {
  info "these dotfiles don't use \`brew\` in Linux environments"
  info 'skipping install'
  return
}

command -v brew > /dev/null && {
  info '`brew` installed, skipping installation'
  return
}

info '`brew` not installed, installing now...'

# installation - https://brew.sh/
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install.sh)"

# fix permissions issues for `compinit` caused by Homebrew messing with things
#
# ref - https://stackoverflow.com/a/43544733
#
# TODO: run conditionally
compaudit | xargs chown -R "$(whoami)"
compaudit | xargs chmod go-w

brew analytics off # disable analytics
