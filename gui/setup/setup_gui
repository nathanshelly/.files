#! /usr/bin/env zsh

# check that DOTFILES variable is defined
# relative path handling is tricky and never foolproof
# ref - https://stackoverflow.com/a/18814147
check_dotfiles_path="${0:A:h}/../../infra/setup/check_dotfiles_variable.sh"
source "$check_dotfiles_path:a" # resolve `../..` to valid path

# source so that `brew` is usable in the current shell for the next steps
source "$DOTFILES/gui/setup/setup_brew" || {
  echo 'Homebrew installation failed. Please fix any errors and try again.'
  exit 1
}

# run in separate subshells

# install casks in `$DOTFILES/gui/apps/Brewfile`
"$DOTFILES/gui/setup/setup_desktop_apps" "$@"

# symlink config files to their correct locations
"$DOTFILES/infra/setup/bin/symlink" "$@" --gui
